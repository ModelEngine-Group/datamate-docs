---
title: 数据合成
description: 使用大模型进行数据增强和合成
weight: 5
---

{{% pageinfo %}}
数据合成模块利用大模型能力，自动生成高质量的训练数据，降低数据采集成本。
{{% /pageinfo %}}

## 功能概述

数据合成模块提供：

- **指令模板管理**：创建和管理合成指令模板
- **单任务合成**：创建单个合成任务
- **比例合成任务**：按指定比例合成多类别数据
- **大模型集成**：支持多种大模型 API
- **质量评估**：自动评估合成数据质量

## 快速开始

### 1. 创建指令模板

#### 步骤 1：进入数据合成页面

在左侧导航栏选择 **数据** → **数据合成** → **任务**。

#### 步骤 2：创建指令模板

1. 点击 **指令模板** 标签
2. 点击 **创建模板** 按钮

#### 步骤 3：配置模板

**基本信息**：
- **模板名称**：例如 `qa_generation_template`
- **模板描述**：描述模板用途（可选）
- **模板类型**：选择模板类型（问答、对话、摘要等）

**提示词配置**：

示例提示词：
```
你是一个专业的数据生成助手。请根据以下要求生成数据：

任务：生成问答对
主题：{topic}
数量：{count}
难度：{difficulty}

要求：
1. 问题要清晰明确
2. 答案要准确完整
3. 涵盖不同难度级别

输出格式：JSON
[
  {
    "question": "...",
    "answer": "..."
  }
]
```

**参数配置**：
- **模型**：选择使用的大模型（GPT-4、Claude、本地模型等）
- **温度**：控制生成随机性（0-1）
- **最大 tokens**：限制生成长度
- **其他参数**：根据模型配置

#### 步骤 4：保存模板

点击 **保存** 按钮保存模板。

### 2. 创建合成任务

#### 步骤 1：创建任务

1. 返回 **数据合成** 页面
2. 点击 **创建任务** 按钮

#### 步骤 2：配置基本信息

- **任务名称**：例如 `medical_qa_synthesis`
- **任务描述**：描述任务目的（可选）
- **选择模板**：选择已创建的指令模板

#### 步骤 3：配置参数

根据模板的参数配置：

| 参数 | 值 | 说明 |
|------|-----|------|
| topic | 医疗健康 | 合成主题 |
| count | 100 | 生成数量 |
| difficulty | 中等 | 难度级别 |

#### 步骤 4：配置输出

- **输出数据集**：选择或创建输出数据集
- **输出格式**：选择输出格式（JSON、CSV、JSONL 等）

#### 步骤 5：创建并执行

点击 **创建** 按钮创建任务。任务将自动开始执行。

### 3. 创建比例合成任务

比例合成任务用于按指定比例合成多类别平衡数据。

#### 步骤 1：创建比例任务

1. 在左侧导航栏选择 **数据** → **数据合成** → **比例任务**
2. 点击 **创建任务** 按钮

#### 步骤 2：配置任务

**基本信息**：
- **任务名称**：例如 `balanced_dataset_synthesis`
- **任务描述**：描述任务目的

**类别配置**：

| 类别 | 比例 | 指令模板 | 数量 |
|------|------|----------|------|
| 正面 | 40% | positive_template | 400 |
| 负面 | 30% | negative_template | 300 |
| 中性 | 30% | neutral_template | 300 |

#### 步骤 3：执行任务

点击 **创建** 按钮创建任务。系统将按比例为每个类别生成数据。

### 4. 监控合成任务

#### 查看任务列表

在数据合成页面，可以看到所有合成任务：

| 任务名称 | 模板 | 状态 | 进度 | 生成数量 | 操作 |
|---------|------|------|------|----------|------|
| 医疗问答合成 | qa_template | 运行中 | 50% | 50/100 | 查看详情 |
| 情感数据合成 | sentiment_template | 已完成 | 100% | 1000/1000 | 查看详情 |

#### 查看任务详情

点击任务名称进入详情页面，可以看到：

- **任务配置**：模板和参数配置
- **执行记录**：历史执行记录
- **生成结果**：
  - 总生成数量
  - 成功数量
  - 失败数量
  - 成功率

#### 查看生成数据

在任务详情页面，点击 **查看数据** 可以：

- 预览生成的数据
- 下载数据
- 导出到数据集

## 高级功能

### 模板变量

在提示词中使用变量，实现动态配置：

**变量语法**：`{variable_name}`

**示例**：
```
请生成关于 {topic} 的 {count} 个 {difficulty} 级别的 {type}。
```

**内置变量**：
- `{current_date}`：当前日期
- `{current_time}`：当前时间
- `{random_id}`：随机 ID

### 模型选择

DataMate 支持多种大模型：

| 模型 | 类型 | 说明 |
|------|------|------|
| GPT-4 | OpenAI | 高质量生成 |
| GPT-3.5-Turbo | OpenAI | 快速生成 |
| Claude 3 | Anthropic | 长文本生成 |
| 文心一言 | 百度 | 中文优化 |
| 通义千问 | 阿里 | 中文优化 |
| 本地模型 | 部署本地模型 | 私有化部署 |

### 数据质量控制

启用数据质量评估：

- **格式验证**：验证输出格式
- **内容检查**：检查敏感词、不当内容
- **重复检测**：检测重复生成的内容
- **质量评分**：对生成内容打分

### 批量生成

对于大规模数据生成：

1. **分批生成**：将大批量任务拆分为多个小批次
2. **并发控制**：控制并发请求数量
3. **失败重试**：自动重试失败的生成请求
4. **断点续传**：支持从中断处继续生成

## 最佳实践

### 1. 提示词设计

好的提示词应该：

- **明确任务**：清晰描述生成任务
- **指定格式**：明确输出格式要求
- **提供示例**：给出期望的输出示例
- **控制质量**：设置质量要求

**示例提示词**：
```
你是一个专业的教育内容创作助手。

任务：生成教育问答对
学科：{subject}
年级：{grade}
数量：{count}

要求：
1. 问题要符合该年级的知识水平
2. 答案要准确、详细、易懂
3. 每个答案包含解析过程
4. 不得生成敏感或不当内容

输出格式（JSON）：
[
  {
    "id": 1,
    "question": "问题内容",
    "answer": "答案内容",
    "explanation": "解析内容",
    "difficulty": "easy/medium/hard",
    "knowledge_points": ["知识点1", "知识点2"]
  }
]

请开始生成：
```

### 2. 参数调优

根据需求调整模型参数：

| 参数 | 高质量 | 快速生成 | 创意生成 |
|------|--------|----------|----------|
| 温度 | 0.3-0.5 | 0.1-0.3 | 0.7-1.0 |
| 最大 tokens | 根据需求 | 较短 | 较长 |
| Top P | 0.9-0.95 | 0.9 | 0.95-1.0 |

### 3. 数据验证

生成后进行数据验证：

1. **格式检查**：检查输出格式是否正确
2. **内容审核**：人工抽查部分数据
3. **质量评估**：使用评估工具打分
4. **去重**：去除重复或高度相似的内容

## 常见问题

### Q: 生成数据质量不理想怎么办？

A: 优化建议：

1. **改进提示词**：更详细、更明确的指令
2. **调整参数**：降低温度、增加最大 tokens
3. **提供示例**：在提示词中给出示例
4. **更换模型**：尝试其他大模型
5. **人工审核**：人工审核和筛选

### Q: 生成速度慢怎么办？

A: 加速建议：

1. **减少数量**：分批生成，不要一次性生成过多
2. **调整并发**：适当增加并发数
3. **使用更快的模型**：如 GPT-3.5-Turbo
4. **缩短输出**：减少最大 tokens
5. **使用本地模型**：部署本地模型加速

### Q: 如何保证生成数据的多样性？

A: 增加多样性：

1. **提高温度**：设置温度为 0.7-1.0
2. **丰富提示词**：在提示词中加入变化元素
3. **多次生成**：多次生成后去重
4. **使用不同种子**：改变随机种子
5. **混合模型**：使用多个模型生成

### Q: 生成的数据有重复怎么办？

A: 去重方法：

1. **启用去重**：在任务配置中启用去重功能
2. **调整温度**：提高温度增加随机性
3. **丰富提示词**：在提示词中加入更多变化
4. **后处理去重**：使用去重工具处理

### Q: 如何控制生成成本？

A: 成本控制：

1. **选择合适模型**：根据需求选择模型
2. **控制长度**：限制最大 tokens
3. **批量处理**：使用批量 API（如果支持）
4. **缓存复用**：缓存相似请求的结果
5. **本地模型**：对于大规模生成，考虑部署本地模型

## API 参考

详细的 API 文档请参考：
- [数据合成 API](/docs/api-reference/data-synthesis/)

## 相关文档

- [数据评估](/docs/user-guide/data-evaluation/) - 评估合成数据质量
- [数据管理](/docs/user-guide/data-management/) - 管理合成数据
- [流水线编排](/docs/user-guide/orchestration/) - 将合成任务集成到流水线
